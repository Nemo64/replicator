{
    "sources": {
        "calendars": {
            "type": "filesystem",
            "path": "source/*.json",
            "format": {"type": "json", "schema": "schemas/source-calendar.json"}
        }
    },
    "views": [
        {
            "source": "calendars",
            "matrix": {
                "user": "{source.shared_with|map(.user)|prepend(source.owner)}"
            },
            "target": {
                "type": "filesystem",
                "path": "views/{matrix.user}/calendars.json",
                "format": {"type": "json", "schema": "schemas/view-calendars.json"}
            },
            "format": {
                "name": "{source.name}",
                "privilege": "{source.shared_with|filter(.user == matrix.user)|map(.privilege)|pick|default('owner')}"
            }
        },
        {
            "source": "calendars",
            "matrix": {
                "user": "{source.shared_with|map(.user)|prepend(source.owner)}",
                "appointment": "{source.appointments}"
            },
            "target": {
                "type": "filesystem",
                "path": "views/{matrix.user}/{matrix.appointment.time|strftime('%Y-%m')}.json",
                "format": {"type": "json", "schema": "schemas/view-appointments.json"}
            },
            "format": {
                "calendar": {
                    "name": "{source.name}",
                    "privilege": "{source.shared_with|filter(.user == matrix.user)|map(.privilege)|pick|default('owner')}"
                },
                "name": "{matrix.appointment.name}",
                "time": "{matrix.appointment.time}"
            }
        }
    ]
}
